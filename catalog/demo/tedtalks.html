<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>TED Talks</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="../js/d3.4.2.6.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="../keshif.js" charset="utf-8"></script>
    <link rel="stylesheet" href="../keshif.css" type="text/css">
    <link rel="stylesheet" href="../font-awesome/css/font-awesome.min.css">

    <script type="text/javascript" src="../js/pikaday.js" charset="utf-8"></script>
    <link rel="stylesheet" href="../js/pikaday.css" type="text/css">

    <script type="text/javascript" src="./js/demo.js" charset="utf-8"></script>
    <link rel="stylesheet" href="./css/demo.css" type="text/css">

    <script type="text/javascript">
google.charts.setOnLoadCallback(function(){
  browser = new kshf.Browser({
    domID: "#demo_Browser",
    barChartWidth: 90,
    leftPanelLabelWidth: 120,
    rightPanelLabelWidth: 140,
    recordName: "TED Talks",
    source: {
      gdocId: '1N5Pk58GmTYAPSC6biWL8K2auf40jYbAQRstKeEWO8yY',
      tables: "Talks"
    },
    summaries: [
      { name: "Feelings", catSplit: "+" },
      { name: "Talk Duration", value: function(){ return this.Duration[0]; }, unitName: "min" },
      { name: "Views",
        value: function(){
          var views = this.Views;
          if(views[views.length-1]==="M") {
            views = 1000000*views.substr(0,views.length-1)
          } else if(views[views.length-1]==="K") {
            views = 1000*views.substr(0,views.length-1)
          }
          return 1*views;
        }},
      { name: "Speaker", catSplit: /(?: and )|(?:, )/, panel: 'right' },
      { name: "Date", panel: 'bottom' }
    ],
    recordDisplay: {
      sortBy: 'Views',
      textSearch: 'Title',
      displayType: 'grid',
      recordView: function(){
        return "<a target='_blank' href='http://www.ted.com/talks/"+this.URL+"'><span class='thumbnail'>"+
          "<img class='thumbImg' src='http://img.tedcdn.com/r/images.ted.com/images/ted/"+this.ThumbImg+"'></span></a>"+
          "<span class='subTitle'>"+this.Speaker+"</span>"+
          "<span class='title'>"+this.Title+"</span>";
      }
    }
  });
});

// For retrieving data from source Ted Talks pages, you can use this function.
var getData = function(){
  var logStr="";
  for(var i=1; i<=49;i++){
    $.ajax({
      type: 'GET',
      dataType: 'html',
      url: "http://www.ted.com/talks/browse?page="+i,
      asynch: false,
      success: function(doc){
        $($.parseHTML(doc)).find(".m3").each(function(i){
          var $this = $(this);
          var thumb = $this.find(".thumb__image")[0].getAttribute("src");
          var talkDur = $this.find(".talk-link__image > a > span.thumb--crop-top > .thumb__duration")[0].textContent;
          var speaker = $this.find(".talk-link__speaker")[0].textContent;
          var title = $this.find(".media__message > .m5 > a")[0].textContent.trim();
          var link = $this.find(".media__message > .m5 > a")[0].getAttribute("href");
          var feelings = $this.find(".media__message >.meta >.meta__row >.meta__val")[0].textContent;
              feelings = feelings.replace(", ","+").trim();
          var views = $this.find(".media__message >.meta > span:nth-child(1) > .meta__val")[0].textContent.trim();
              views = views.replace("\n","").replace("views","").replace(' ',"");
          var datee = $this.find(".media__message >.meta > span:nth-child(2) > .meta__val")[0].textContent.trim();
          logStr+=link+"\t"+thumb+"\t"+talkDur+"\t"+speaker+"\t"+title+"\t"+feelings+"\t"+views+"\t"+datee+"\n";
        });
      },
      error: function(e, e2, e3){console.log("NO: page:"+i+" code:"+e2); }
    });
  }
  console.log(logStr);    
};
    </script>
<style id="kshfStyle">
.kshfRecord{ max-width: 150px; }
.content{ padding: 3px; }
.thumbnail{ height: 75px; }
</style>
  </head>
  <body>
    <div class="contents">
      <div id="demo_Browser"></div>
      </div>
  </body>
</html>